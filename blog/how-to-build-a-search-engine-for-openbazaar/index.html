<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="zI3sAn6GTCII6X2rmUMR1uHZG5crfyuVmzRoaqXmDq4" /><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>How To Build a Search Engine for OpenBazaar | OpenBazaar</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="How To Build a Search Engine for OpenBazaar" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="by OpenBazaar Lead Backend Developer Chris Pacia" />
<meta property="og:description" content="by OpenBazaar Lead Backend Developer Chris Pacia" />
<link rel="canonical" href="https://openbazaar.org/blog/how-to-build-a-search-engine-for-openbazaar/" />
<meta property="og:url" content="https://openbazaar.org/blog/how-to-build-a-search-engine-for-openbazaar/" />
<meta property="og:site_name" content="OpenBazaar" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-21T14:30:00+00:00" />
<script type="application/ld+json">
{"description":"by OpenBazaar Lead Backend Developer Chris Pacia","@type":"BlogPosting","url":"https://openbazaar.org/blog/how-to-build-a-search-engine-for-openbazaar/","headline":"How To Build a Search Engine for OpenBazaar","dateModified":"2018-08-21T14:30:00+00:00","datePublished":"2018-08-21T14:30:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://openbazaar.org/blog/how-to-build-a-search-engine-for-openbazaar/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="shortcut icon" type="image/png" href="/favicon.png">
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/main.css">
  
    <meta property="og:image" content="https://openbazaar.org/blog/">
    <meta property="og:title" content="How To Build a Search Engine for OpenBazaar">
    <meta property="og:description" content="How To Build a Search Engine for OpenBazaar">
  <link type="application/atom+xml" rel="alternate" href="https://openbazaar.org/feed.xml" title="OpenBazaar" /><script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-P8J7H5F');
</script>

</head>
<body><!-- Google Tag Manager (noscript) -->
<noscript>
  <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P8J7H5F" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->
<header class="container">
    <nav class="navbar navbar-expand-lg navbar-light">
        <a class="navbar-brand" href="/">
            <img class="openbazaar-logo" alt="openbazaar logo" src="/assets/home/openbazaar-logo-316bbba492da4a2a44a7ad012f1054fdf0c47c1068d5a949f86bab5ab23a5980.png" integrity="sha256-MWu7pJLaSipEp60BLxBU/fDEfBBo1alJ+GurWrI6WYA=" crossorigin="anonymous">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-top" aria-controls="navbar-top"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span> Menu
        </button>
        <div class="collapse navbar-collapse text-center text-lg-left" id="navbar-top">
            
            <ul class="navbar-nav ml-auto"><li class="nav-item ml-md-2 ">
                    <a class="nav-link" href="/features/">Features
                        
                    </a>
                </li>
                <li class="nav-item ml-md-2 ">
                    <a class="nav-link" href="/applications/">
                        Applications
                        
                    </a>
                </li>
                <li class="nav-item ml-md-2">
                    <a class="nav-link" href="https://api.openbazaar.org/" target="_blank">API</a>
                </li>
                <li class="nav-item ml-md-2 ">
                    <a class="nav-link" href="/developers/">
                        Developers
                        
                    </a>
                </li>
                <li class="nav-item ml-md-2 ">
                    <a class="nav-link" href="/support/">
                        Support
                        
                    </a>
                </li>
                <li class="nav-item ml-md-2 active ">
                    <a class="nav-link" href="/blog/">
                        Blog
                        
                            <span class="sr-only">(current)</span>
                        
                    </a>
                </li>
                <li class="nav-item ml-md-2">
                    <a href="/mobile-updates/" class="button small download d-lg-none">Get It for Desktop</a>
                    <a href="/download/" class="button small download d-none d-lg-inline-flex">DOWNLOAD</a>
                </li>
            </ul>
        </div>
    </nav>
</header><main class="page-content" aria-label="Content">
      <div class="wrapper content">
        <article class="container limited">
    <div class="row">
        <div class="col-12">
            <section class="row pt-0 ">
    
        <div class="col-12 post-heading-image w-100 border-bottom">

        </div>
        <img class="post-openbazaar-logo mx-auto" alt="openbazaar-log0" src="/assets/blog/openbazaar-logo-9bc1d7020f444dc7e779cd01ca965d93105c47c54b6a58bd4d9df0592cf640f9.png" integrity="sha256-m8HXAg9ETcfnec0BypZdkxBcR8VLali9TZ3wWSz2QPk=" crossorigin="anonymous">
    
    <div class="col-12">
        <div class="row text-center mt-4">
            
                <div class="col"></div>
                <div class="col-8">
                    <a href="/blog/how-to-build-a-search-engine-for-openbazaar/">
                        <h3 class="post-title">
                            How To Build a <span class='post-title-extra'>Search Engine</span> for OpenBazaar
                        </h3>
                    </a>
                </div>
                <div class="col"></div>
                <div class="col-12 d-flex justify-content-between my-4">
                    <div class="post-emojis">
                        <i class="fab fa-bitcoin post-icon-bitcoin"></i>
                        <img draggable="false" class="emoji medium post-emoji" alt="world emoji" src="https://s.w.org/images/core/emoji/2.4/svg/1f30e.svg">
                        <img draggable="false" class="emoji medium post-emoji" alt="✌" src="https://s.w.org/images/core/emoji/2.4/svg/270c.svg">
                    </div>
                    <a class="post-openbazaar-link" href="/">OpenBazaar.org</a>
                </div>
            
            <div class="col-12 post-date text-left mb-3">
                Aug 21, 2018
            </div>
            
                <div class="col-12 text-left post-container">
                    <p><em>by OpenBazaar Lead Backend Developer Chris Pacia</em></p>

<p>When we were designing <a href="https://openbazaar.org/download">OpenBazaar</a>, now the world’s largest decentralized marketplace, we knew the general approach to creating a <strong>search engine</strong> that delivered high quality results was to use a centralized server to index listings and run search queries. A centralized search experience, however, was completely out of line with the <strong>freedom</strong> and <strong>flexibility</strong> this open-source marketplace represents. We knew there had to be some intermediate step we could take.</p>

<h3 id="a-federated-approach">A Federated Approach</h3>

<p>We decided to do what few other platforms have done and open it up so that <a href="https://openbazaar.org/blog/decentralized-search-and-content-discovery-on-openbazaar/">anyone can create a search engine that is compatible with the OpenBazaar app</a>. This would allow us to start by building our own search engine to help users navigate the network but would relieve their total reliance on it. All the data that needs to be indexed is <strong>public</strong> and anyone can create and run a search engine of their own.</p>

<h3 id="building-a-search-engine-for-openbazaar">Building a Search Engine for OpenBazaar</h3>

<p>I have written a brief overview of how to build a search engine for OpenBazaar and described some of the outstanding issues we are still working on. It does take some technical skill to build a search engine, but developers with previous experience building and maintaining online infrastructure should be able to create a simple version without too much difficulty.</p>

<h3 id="step-1---finding-peers">Step 1 - Finding Peers</h3>

<p>Step one is to build a database of all the peers you want index. There are several ways you can do this:</p>

<p><strong>1) Actively crawl the network</strong></p>

<p>The openbazaar-go API provides a couple of APIs to make this easy. <code class="highlighter-rouge">/ob/peers</code> returns a list of peers you’re connected to:</p>

<p><img src="ob peers.png" alt="ob peers - How To Build a Search Engine on OpenBazaar" title="ob peers - How To Build a Search Engine on OpenBazaar" /></p>

<p>And <code class="highlighter-rouge">/ob/closestpeers/&lt;peerID&gt;</code> returns a list of “closer” peers from the DHT. One can crawl the network for more nodes just by iterating over your current peer database and fetching closer peers.</p>

<p><img src="ob closest peers.png" alt="ob closest peers - How To Build a Search Engine on OpenBazaar" title="ob closest peers - How To Build a Search Engine on OpenBazaar" /></p>

<p>You can also use the <code class="highlighter-rouge">/ob/peerinfo/&lt;peerID&gt;</code> endpoint to look at their IP address if you wanted to index only Tor stores, for example.</p>

<p><strong>2) Passively listen for new peers</strong></p>

<p>For this you’d likely want several nodes running at the same time. From there you could stream
peerIDs to your database every time one of your nodes receives a new connection. You might not get all peers this way but you should find most. <code class="highlighter-rouge">openbazaar-go</code> nodes do not expose an API which streams new peer connections so you’d have to patch a node to get this data. Creating such an API should be relatively easy and it’s something we are considering doing.</p>

<p><strong>3) Subscribe to pubsub</strong></p>

<p>We are just now starting to make use of the libp2p’s pubsub capabilities. Currently only IPNS data is broadcast to pubsub channels but hopefully relatively soon we will have all nodes announce new publishes over a pubsub channel. Normal users will not be subscribed to this data–as it is a lot of data–but for people who are building search engines this would be perfect.</p>

<p>Depending on what data we include in the publish, you should be able to subscribe to the appropriate channel and receive streaming updates from every peer. We’ll be sure to announce and document this functionality when it is available.</p>

<p><strong>4) Manual curation</strong></p>

<p>You could also just manually enter the peerIDs of stores you find interesting in your database. This isn’t actually a bad strategy if you want your search engine to target specific types of products. Complex machine learning algorithms would likely also work for this if you are particularly adventurous.</p>

<h3 id="step-2---indexing-stores">Step 2 - Indexing Stores</h3>

<p>Now that you have a list of stores it’s time to index them. <code class="highlighter-rouge">/ob/listings/&lt;peerID&gt;</code> will give you a list of all the store’s listings.</p>

<p><img src="indexing stores on openbazaar.png" alt="Indexing Stores on OpenBazaar" title="Indexing Stores on OpenBazaar" /></p>

<p>And if you grab the hash from a listing you can get the full details by using <code class="highlighter-rouge">/ob/listing/&lt;peerID&gt;/&lt;hash&gt;</code></p>

<p><img src="ob listing peerid hash.png" alt="ob listing peerid hash - How To Build a Search Engine on OpenBazaar" title="ob listing peerid hash - How To Build a Search Engine on OpenBazaar" /></p>

<p>You will also need the user’s profile which you can get from <code class="highlighter-rouge">/ob/profile/&lt;peerID&gt;</code></p>

<p><img src="ob profile peerid.png" alt="ob profile peerid - How To Build a Search Engine on OpenBazaar" title="ob profile peerid - How To Build a Search Engine on OpenBazaar" /></p>

<p>Then you can put the listings in whatever database you please to index and search them. Your API just needs to conform to the specification in <a href="https://github.com/OpenBazaar/obips/blob/master/obip-0002.md">OBIP2</a> and it will be compatible with the client.</p>

<p>To see your search engine when your stores are indexed, enter the URL here in the OpenBazaar client:</p>

<p><img src="add your search engine to openbazaar.png" alt="Add your search engine to OpenBazaar - How To Build a Search Engine on OpenBazaar" title="Add your search engine to OpenBazaar - How To Build a Search Engine on OpenBazaar" /></p>

<h3 id="step-3---keeping-content-fresh">Step 3 - Keeping Content Fresh</h3>

<p>The biggest challenge with running a search engine is avoiding serving stale content. Given that OpenBazaar is still fairly new, users may come and go frequently. You want to avoid serving listings for stores where the owner has not been online in a long time to make sure to give potential buyers a fresh discovery experience.</p>

<p>Further, listings are not guaranteed to persist on the network longer than a week after a vendor has gone offline. It still <em>may</em> be visible to some users due to caching, but not everyone may be able to see the listing. If you serve old listings, a potential buyer might click on it only to get a Not Found error. We recommend not serving listings from vendors which have not been identified as being online at least once within the past week.</p>

<p>How do you determine that? Admittedly this is an area where we are still working to improve but there are a few ways.</p>

<p>First, make sure your database of peerIDs also tracks the last seen or last good timestamp for the peer. Next, you have several ways you could update the timestamp:</p>

<p><strong>1) Ping each peer</strong></p>

<p>The <code class="highlighter-rouge">/ob/status/&lt;peerID&gt;</code> endpoint will attempt to ping them and tell you if they are online.</p>

<p><img src="ob status peerid endpoint.png" alt="ob status peerid endpoint - How To Build a Search Engine on OpenBazaar" title="ob status peerid endpoint - How To Build a Search Engine on OpenBazaar" /></p>

<p>The problem, however, is that about 60% of nodes on the network are unreachable due to NAT traversal issues. Tor nodes tend to have even worse issues as many users run on operating systems like Tails and Whonix which lock down the control port and make it difficult to accept incoming connections. So this only gets you part of the way there.</p>

<p><strong>2) Passively listen for incoming connections</strong></p>

<p>This is similar to 2) above in Finding Peers. You could update the timestamp for a peer every time they connect to you but again this will either require patching your node or for us to provide an API to get the data. This also will not cover every peer you’re interested in unless you run many nodes.</p>

<p><strong>3) Disable caching</strong></p>

<p>If you set <code class="highlighter-rouge">"UsePersistentCache": false</code> in your node’s config file it will stop returning from cache and will do a new DHT crawl each time you request user data. If the data has dropped out of the network, you will know about it as the data will return not found. If it’s not found, you should generally not serve up that peer’s data.</p>

<p>Additionally, you’ll likely also want to set <code class="highlighter-rouge">"BackUpAPI": ""</code> in the config as by default it will try to get the record from our gateway’s cache if the record cannot be found in the DHT.</p>

<p><strong>4) Use IPNS record validity</strong></p>

<p>Every time a user publishes new content they publish an IPNS record containing an expiration date in the DHT. That expiration date is the time at which the user’s listings will drop out of the network absent them re-publishing which happens automatically when their node starts up and once a day thereafter.</p>

<p>When you query for a user’s listings or profile or anything else, your node looks up the IPNS record. You could theoretically use this expiration date as a proxy for the last good timestamp for the peer and beyond that stop serving their listings.</p>

<p>This data is not yet exposed in our API and it’s something that we have on our list to develop.</p>

<p><strong>5) Use pubsub</strong></p>

<p>Currently, whenever you query for a peer’s data, it subscribes to streaming updates for that peer. This means you’ll be notified immediately whenever they publish a new IPNS record. Not only does this tell you when they have signed online, but you could also get the latest IPNS record validity.</p>

<p>Currently, disabling cache–3) above–also disables pubsub and would make this method ineffective. This is another issue that we are working on improving.</p>

<h3 id="step-4---making-money">Step 4 - Making Money!</h3>

<p>It’s entirely possible for you to monetize your work on an OpenBazaar search engine by adding paid ads in your search results. In fact, you could pretty easy sell ad space for your search engine through your own OpenBazaar store!</p>

<h3 id="issues-and-improvements">Issues and Improvements</h3>

<p>This is a general overview of the technical work required for building an OpenBazaar search engine. We’re aware of some areas we would like to improve upon such as creating an API that allows us to stream newly found peerIDs and also have APIs that allow us to inspect IPNS records or pubsub publishes to update our timestamp associated with each peer. We could likely combine all of this into one streaming API that pulls data from all these sources and streams not only new peerIDs that it finds, but also the most up-to-date timestamp for that peer that it is able to decipher. This way search engines only need a single API to update their peers database.</p>

<p>We are constantly working to make it easier for anyone to jump right in and start building on the OpenBazaar platform. If you have any questions or comments about any of this, please join our conversation in <a href="https://openbazaar.org/slack">Slack</a> and tell us what you think.</p>

                </div>
            
        </div>
    </div>
</section>
        </div>
    </div>
</article>
<div class="container-fluid mb-5">
    <div class="row">
        <div class="col-12 pb-4">
            <hr class="help-us-separator">
            <div class="container limited">
                <p>
                    <strong>Do you want to help build this with us?</strong>
                </p>
                <p>
                    <a href="/download/" class="general-link" target="_blank">Download OpenBazaar</a> right now to start buying or selling in minutes or just see what's for sale at <a class="general-link" href="https://openbazaar.com" target="_blank">OpenBazaar.com</a>. 
                </p>
                <p>
                    Developers, join us on <a class="general-link" href="https://github.com/openbazaar" target="_blank">Github</a> to contribute to this open-source project!
                </p>
                <p>
                    <!-- AddToAny BEGIN -->
                    <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
                        <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
                        <a class="a2a_button_tumblr"></a>
                        <a class="a2a_button_facebook"></a>
                        <a class="a2a_button_twitter"></a>
                    </div>
                    <script async src="https://static.addtoany.com/menu/page.js"></script>
                    <!-- AddToAny END -->
                </p>
            </div>
        </div>
    </div>
    <div class="row recent-updates-wrapper border-bottom border-top">
    <div class="col-12">
        <section class="container">
            <div class="row">
                <div class="col-12 mb-4 emphasis-text">
                    <h3 class="recent-updates-heading">Recent updates</h3>
                </div>
                <div class="col-12">
                    <div class="card-deck text-center">
                        
                            <div class="card p-3 mb-4">
                                <div class="card-body d-flex flex-column justify-content-between">
                                    <a href="/blog/OpenBazaar-Developer-Call-December-13-2018/">
                                        <h5 class="recent-updates-title">OpenBazaar Developer Call - December 13, 2018</h5>
                                    </a>
                                    <div class="recent-updates-body mt-2">
                                        This is a video recording of the OpenBazaar Developer call on December 13, 2018.


                                    </div>

                                    <a href="/blog/OpenBazaar-Developer-Call-December-13-2018/" class="button small mt-4 mx-auto">read more</a>
                                </div>
                            </div>
                        
                            <div class="card p-3 mb-4">
                                <div class="card-body d-flex flex-column justify-content-between">
                                    <a href="/blog/how-openbazaar-bitcoin-could-kill-the-american-pickers-economy/">
                                        <h5 class="recent-updates-title">How OpenBazaar & Bitcoin Could Kill the American Pickers Economy</h5>
                                    </a>
                                    <div class="recent-updates-body mt-2">
                                        By Sam Patterson, OB1 Co-Founder


                                    </div>

                                    <a href="/blog/how-openbazaar-bitcoin-could-kill-the-american-pickers-economy/" class="button small mt-4 mx-auto">read more</a>
                                </div>
                            </div>
                        
                            <div class="card p-3 mb-4">
                                <div class="card-body d-flex flex-column justify-content-between">
                                    <a href="/blog/openbazaar-shopping-and-selling-survival-guide-last-minute-holiday-edition/">
                                        <h5 class="recent-updates-title">OpenBazaar Shopping and Selling Survival Guide - Last Minute Holiday Edition</h5>
                                    </a>
                                    <div class="recent-updates-body mt-2">
                                        Staying ahead of the holiday season can be a challenge for shoppers and sellers alike. What’s an OpenBazaar user to do when they find themselves already in December and they still need to buy some gifts and/or squeeze in...
                                    </div>

                                    <a href="/blog/openbazaar-shopping-and-selling-survival-guide-last-minute-holiday-edition/" class="button small mt-4 mx-auto">read more</a>
                                </div>
                            </div>
                        
                            <div class="card p-3 mb-4">
                                <div class="card-body d-flex flex-column justify-content-between">
                                    <a href="/blog/openbazaar-2-turns-1-lessons-learned/">
                                        <h5 class="recent-updates-title">OpenBazaar 2 Turns 1: Lessons Learned</h5>
                                    </a>
                                    <div class="recent-updates-body mt-2">
                                        This month we’ve been celebrating the one year anniversary of OpenBazaar 2.0. To read a summary of the last year, read Brian Hoffman’s piece.


                                    </div>

                                    <a href="/blog/openbazaar-2-turns-1-lessons-learned/" class="button small mt-4 mx-auto">read more</a>
                                </div>
                            </div>
                        
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>
</div>
      </div>
    </main><div class="container">
    <footer class="row pb-4">
        <div class="col-12 col-md-8">
            <nav class="navbar navbar-expand-sm navbar-light">
                <div class="collapse show navbar-collapse text-center text-sm-left" id="navbar-bottom">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link " href="/about/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="/events/">Events</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="/newsletter/">Newsletter</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="/contributors/">Contributors</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="/bitcoin/">Need Bitcoin?</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="/donate/">Donate</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="/privacy/">Privacy</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
        <div class="col-12 col-md-4 d-flex flex-row justify-content-md-end justify-content-center">
            <a href="https://twitter.com/openbazaar">
                <i class="social-icon ml-2 fab fa-twitter d-flex align-items-center"></i>
            </a>
            <a href="/slack">
                <i class="social-icon ml-2 fab fa-slack-hash d-flex align-items-center"></i>
            </a>
            <a href="https://www.reddit.com/r/OpenBazaar/">
                <i class="social-icon ml-2 fab fa-reddit-alien d-flex align-items-center"></i>
            </a>
            <a href="https://github.com/openbazaar">
                <i class="social-icon ml-2 fab fa-github d-flex align-items-center"></i>
            </a>
            <a href="mailto:project@openbazaar.org" target="_top">
                <i class="social-icon ml-2 fas fa-envelope d-flex align-items-center"></i>
            </a>
        </div>
    </footer>
</div>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="/assets/app-ac637ccb876dfcbfc8f39a55a38191bc750e676f622196ba9dcf469b9e3b327e.js" integrity="sha256-rGN8y4dt/L/I85pVo4GRvHUOZ29iIZa6nc9Gm547Mn4=" crossorigin="anonymous" type="text/javascript"></script>
  </body>

</html>
